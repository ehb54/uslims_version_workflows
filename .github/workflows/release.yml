# ===========================================================
#  Caller Workflow (UI): Set version and create tag
#
#  PURPOSE:
#    This workflow provides a manual UI ("Run workflow") for
#    releasing a version in THIS repository. It delegates the
#    actual work to a reusable workflow stored elsewhere.
#
#    It:
#      1. Prompts the user for a version string
#      2. Prompts the user for dry-run vs. real release
#      3. Calls the reusable workflow `set-version-tag.yml`
#         and passes inputs through
#
#  WHERE THE REAL WORK HAPPENS:
#    - The reusable workflow writes VERSION, optionally commits,
#      and optionally tags v<version>.
#    - This caller only collects inputs and triggers the reusable
#      workflow.
#
#  USAGE:
#    - Go to: Actions â†’ "Release (set version + tag)"
#    - Click: "Run workflow"
#    - Enter:
#        version         (e.g. 4.1.2, 4.1.2-RC1)
#        mode            (test only vs commit+tag)
#
#  BEHAVIOR:
#    - Dry-run: no commit, no tag
#    - Real release: commit VERSION to main + create tag v<version>
#
#  NOTES:
#    - This workflow must grant `contents: write` so the reusable
#      workflow can push commits/tags in this repo.
# ===========================================================
name: Release (set version + tag)

on:
  workflow_dispatch:
    inputs:
      version:
        description: "Version (e.g., 4.1.2, 4.1.2-RC1, 2025.01.03)"
        required: true
        type: string

      perform_release:
        description: "Perform actual release? (commit VERSION + create tag)"
        required: true
        type: choice
        options:
          - "No (test only)"
          - "Yes (commit + tag)"
        default: "No (test only)"

permissions:
  # Required so the CALLED workflow can push commits and create tags in THIS repo
  contents: write

jobs:
  call-set-version-tag:
    uses: ehb54/uslims_version_workflows/.github/workflows/set-version-tag.yml@main
    with:
      version: ${{ inputs.version }}
      # Convert dropdown choice -> boolean expected by the reusable workflow
      perform_release: ${{ inputs.perform_release == 'Yes (commit + tag)' }}
